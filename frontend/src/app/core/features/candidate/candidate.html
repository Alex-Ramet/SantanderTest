<div class="container">
  <div class="header-card">
    <div class="header-content">
      <h1>Santander Candidate List</h1>
      <button mat-raised class="btn-primary" (click)="openDialog()">
        <mat-icon>add</mat-icon>
        New Candidate
      </button>
    </div>
  </div>

  <div class="table-card">
    <form class="table-container" [formGroup]="filter">
      <table mat-table [dataSource]="data_source" matSort multiTemplateDataRows class="data-table">
        <ng-container matColumnDef="name">
          <th class="text-center" mat-header-cell mat-sort-header *matHeaderCellDef>Name</th>
          <td class="text-center" mat-cell *matCellDef="let candidate">{{ candidate.name }}</td>
        </ng-container>

        <ng-container matColumnDef="name_filter" class="filter-row">
          <th mat-header-cell *matHeaderCellDef class="text-center">
            <input class="filter-input" placeholder="Filter..." formControlName="name" />
          </th>
        </ng-container>

        <ng-container matColumnDef="surname">
          <th class="text-center" mat-header-cell mat-sort-header *matHeaderCellDef>Surname</th>
          <td class="text-center" mat-cell *matCellDef="let candidate">{{ candidate.surname }}</td>
        </ng-container>

        <ng-container matColumnDef="surname_filter" class="filter-row">
          <th mat-header-cell *matHeaderCellDef class="text-center">
            <input class="filter-input" placeholder="Filter..." formControlName="surname" />
          </th>
        </ng-container>

        <ng-container matColumnDef="seniority">
          <th class="text-center" mat-header-cell *matHeaderCellDef>Seniority</th>
          <td class="text-center" mat-cell *matCellDef="let candidate">
            <span
              class="chip"
              [class.senior-chip]="candidate.seniority === 'senior'"
              [class.junior-chip]="candidate.seniority === 'junior'"
            >
              {{ candidate.seniority }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="seniority_filter" class="filter-row">
          <th mat-header-cell *matHeaderCellDef class="text-center">
            <mat-select
              [panelClass]="'custom-panel'"
              class="filter-select"
              formControlName="seniority"
            >
              @for (option of seniorities; track option.label) {
              <mat-option [value]="option.value">{{ option.label }}</mat-option>
              }
            </mat-select>
          </th>
        </ng-container>

        <ng-container matColumnDef="years">
          <th class="text-center" mat-header-cell *matHeaderCellDef mat-sort-header>Years</th>
          <td class="text-center" mat-cell *matCellDef="let candidate">{{ candidate.years }}</td>
        </ng-container>

        <ng-container matColumnDef="years_filter" class="filter-row">
          <th mat-header-cell *matHeaderCellDef class="text-center">
            <input
              type="number"
              class="filter-input"
              placeholder="Filter..."
              formControlName="years"
            />
          </th>
        </ng-container>

        <ng-container matColumnDef="availability">
          <th class="text-center" mat-header-cell *matHeaderCellDef>Availability</th>
          <td class="text-center" mat-cell *matCellDef="let candidate">
            @if (candidate.availability) {
            <span class="availability-chip available">
              <mat-icon class="availability-icon">check_circle</mat-icon>
              Available
            </span>
            } @else {
            <span class="availability-chip unavailable">
              <mat-icon class="availability-icon">cancel</mat-icon>
              Not Available
            </span>
            }
          </td>
        </ng-container>

        <ng-container matColumnDef="availability_filter" class="filter-row">
          <th mat-header-cell *matHeaderCellDef class="text-center">
            <mat-checkbox
              [checked]="filter.get('availability')?.value === true"
              [indeterminate]="filter.get('availability')?.value === null"
              (click)="changeAvailability($event)"
            >
            </mat-checkbox>
          </th>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th class="text-center" mat-header-cell *matHeaderCellDef>Actions</th>

          <td class="text-center" mat-cell *matCellDef="let candidate">
            <button
              class="btn-details"
              (click)="toggleDetails(candidate); $event.stopPropagation()"
            >
              {{ isExpansionDetailRow(0, candidate) ? 'Hide' : 'Details' }}
            </button>
          </td>
        </ng-container>

        <ng-container matColumnDef="actions_filter" class="filter-row">
          <th mat-header-cell *matHeaderCellDef>
            <button class="btn-clear-filters" (click)="clearFilters()">
              <mat-icon>filter_alt_off</mat-icon>
              Clear Filters
            </button>
          </th>
        </ng-container>

        <ng-container matColumnDef="details">
          <td mat-cell *matCellDef="let candidate" [attr.colspan]="displayed_columns.length">
            <div class="expanded-cell">
              <app-candidate-details
                [candidate]="candidate"
                (save)="onSaveDetails($event)"
                (cancel)="onCancelDetails()"
                (delete)="onDeleteCandidate($event)"
              ></app-candidate-details>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayed_columns" class="table-header"></tr>

        <tr mat-header-row *matHeaderRowDef="filter_columns"></tr>

        <tr mat-no-data-row *matNoDataRow>
          <td [attr.colspan]="displayed_columns.length" class="no-data">
            <mat-icon class="no-data-icon">filter_alt</mat-icon>
            <p class="no-data-text">No results found</p>
          </td>
        </tr>

        <tr
          mat-row
          *matRowDef="let row; columns: displayed_columns"
          class="table-data"
          [class.table-data]="isExpansionDetailRow(0, row)"
        ></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: ['details']; when: isExpansionDetailRow"
          class="expanded-row"
        ></tr>
      </table>

      <mat-paginator
        class="paginator-container"
        [pageSizeOptions]="[5, 10, 25, 100]"
        aria-label="Select page of candidates"
      ></mat-paginator>
    </form>
  </div>
</div>
